@model IEnumerable<QuizMaster.Models.Quiz>
@{
    ViewData["Title"] = "Community quiz";
}

@section Styles {
    <link rel="stylesheet" href="~/css/communityquiz.css" />
}

<div class="container pt-4">
    <h2 class="text-center mb-3">Community quiz</h2>

    <div class="d-flex flex-wrap align-items-center justify-content-center gap36 mb-4">
        @*Lọc theo level*@

        <form asp-controller="Home" asp-action="CommunityQuiz" class="search-container d-flex flex-row justify-content-center align-items-center gap12 flex-wrap" method="get">
            <div class="community-quiz-level my-3 d-flex align-items-center">
                <label>Difficulty: </label>
                <select name="difficultyFilter" class="bg-ghost border-0 fw-semibold text-center text-dark">
                    <option value="0" class="text-dark fw-semibold">All</option>
                    <option value="1" class="text-success fw-semibold">Easy</option>
                    <option value="2" class="text-warning fw-semibold">Medium</option>
                    <option value="3" class="text-danger fw-semibold">Hard</option>
                </select>
                <div class="circle mx-2 bg-dark"></div>
            </div>
            <input id="searchQuery" name="searchQuery" class="myBorder border-gray bg-ghost rounded-4" placeholder="Search..." />
            <button class="myButton myButton2-primary" type="submit">Search</button>
        </form>

    </div>

    <div class="row">
        @foreach (var quiz in Model)
        {
            if (quiz.Published)
            {
                <div class="col-12 col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-4" data-difficulty="@quiz.Level" data-bs-toggle="modal" data-bs-target="#detailModal-@quiz.Id">
                    <div class="communityQuizCard">
                        <h5 class="community-quiz-title">@quiz.Title</h5>

                        <span class="community-quiz-summary text-gray-dark">@quiz.Summary</span>

                        <span class="community-quiz-questions">@ReturnQuestion(quiz.QuizQuestions.Count)</span>

                        <span class="community-quiz-difficulty">
                            Difficulty:
                            <strong class="@GetCssClassForDifficulty(quiz.Level)">
                                @ConvertLevelToDifficulty(quiz.Level)
                            </strong>
                        </span>
                    </div>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="detailModal-@quiz.Id" tabindex="-1"
                     aria-labelledby="detailModalLabel-@quiz.Id" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title fs-5">@quiz.Title</h5>
                                <button class="btn-close" type="button" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p class="browse-quiz-details-summary">@quiz.Summary</p>
                                <p class="browse-quiz-details-questions">@quiz.QuizQuestions.Count questions</p>
                                <p class="browse-quiz-quiz-tag">@quiz.Tag</p>
                                <p class="browse-quiz-details-difficulty">
                                    Difficulty:
                                    <strong class="@GetCssClassForDifficulty(quiz.Level)">
                                        @ConvertLevelToDifficulty(quiz.Level)
                                    </strong>
                                </p>

                                <p class="browse-quiz-details-play">@quiz.TakeQuizs.Count plays</p>

                                <p class="browse-quiz-details-createdDate">Created at: @quiz.CreatedAt.ToString("HH:mm dd/MM/yyyy")</p>

                                <div class="browse-quiz-details-ranking fw-semibold text-color2" data-bs-toggle="modal" data-bs-target="#rankingModal-@quiz.Id">
                                    See ranking
                                </div>
                            </div>



                            <div class="modal-footer justify-content-end">
                                <button class="myButton myButton-primary" type="button">
                                    Start quiz
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Ranking Modal -->
                <div class="modal fade" id="rankingModal-@quiz.Id" tabindex="-1"
                     aria-labelledby="rankingModalLabel-@quiz.Id" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0">
                            <span class="p-4 fw-semibold fs-4 text-center">LEADERBOARD</span>

                            <div class="ranking-item ranking-item-first fs-4 fw-semibold bg-color2 d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="ranking-item-rank mx-3">1</span>
                                    Lê Trần Phú
                                </div>
                                <i class="fa-solid fa-trophy fa-xl text-warning"></i>
                            </div>

                            <div class="ranking-item fw-semibold d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="ranking-item-rank mx-3 fs-4">2</span>
                                    Võ Trọng Tình
                                </div>
                                <i class="fa-solid fa-medal fa-2xl" style="color: #C0C0C0"></i>
                            </div>

                            <div class="ranking-item fw-semibold d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="ranking-item-rank mx-3 fs-4">3</span>
                                    Phạm Đức Minh Hiếu
                                </div>
                                <i class="fa-solid fa-medal fa-2xl" style="color: #CD7F32"></i>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }

        <!-- Pagination links -->
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
                <li class="page-item @((ViewBag.CurrentPage == 1) ? "disabled" : "")">
                    <a class="page-link fw-semibold" href="@Url.Action("CommunityQuiz", new { pageIndex = ViewBag.CurrentPage - 1, pageSize = ViewBag.PageSize })">
                        <i class="fa-solid fa-angles-left"></i>
                    </a>
                </li>
                @for (var i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @((i == ViewBag.CurrentPage) ? "active" : "")">
                        <a class="page-link fw-semibold" href="@Url.Action("CommunityQuiz", new { pageIndex = i, pageSize = ViewBag.PageSize })">@i</a>
                    </li>
                }
                <li class="page-item @((ViewBag.CurrentPage == ViewBag.TotalPages) ? "disabled" : "")">
                    <a class="page-link fw-semibold" href="@Url.Action("CommunityQuiz", new { pageIndex = ViewBag.CurrentPage + 1, pageSize = ViewBag.PageSize })">
                        <i class="fa-solid fa-angles-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- End of Pagination links -->


        @functions {
            private string ConvertLevelToDifficulty(int level)
            {
                switch (level)
                {
                    case 1:
                        return "Easy";
                    case 2:
                        return "Medium";
                    case 3:
                        return "Hard";
                    default:
                        return "Unknown";
                }
            }

            private string GetCssClassForDifficulty(int level)
            {
                switch (level)
                {
                    case 1:
                        return "text-success";
                    case 2:
                        return "text-warning";
                    // Các trường hợp khác nếu bạn muốn mở rộng
                    default:
                        return "text-danger";  // Giả sử chúng ta sử dụng text-muted cho các trường hợp không xác định
                }
            }

            private string ReturnQuestion(int num)
            {
                if (num == 1)
                {
                    return "1 Question";
                }
                else
                {
                    return num + " Questions";
                }
            }
        }
    </div>


    <!-- Add this in your CommunityQuiz.cshtml -->
    <div id="searchResults" class="row">
        <!-- Search results will be displayed here -->
    </div>

</div>

@section Scripts {
    <script src="~/js/communityquiz.js"></script>
}